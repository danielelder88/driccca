<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>TABELA DE HORÁRIOS COMPLETA</title>

  <!-- Firebase + html2pdf -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    body {
      font-family: 'Arial Black', Arial, sans-serif;
      background: #f0f0f0;
      text-transform: uppercase;
      padding: 5px;
      font-size: 11px;
      border-top: 1px solid #ccc;
      border-bottom: 1px solid #ccc;
    }
    h1 { 
      text-align: center; 
      font-size: 16px; 
      color: #222; 
      border-bottom: 1px solid #ccc; 
      padding-bottom: 5px;
      margin-bottom: 10px;
    }
    .turno {
      border-radius: 5px;
      padding: 5px;
      margin-bottom: 8px;
      background: white;
      border-left: 5px solid #333;
      page-break-inside: avoid;
      break-inside: avoid;
      max-width: 700px;
      margin: auto;
      border-bottom: 1px solid #ccc;
    }
    .turno h2 { 
      font-size: 12px; 
      font-weight: bold; 
      margin: 5px 0; 
      border-bottom: 1px solid #ccc; 
      padding-bottom: 3px; 
    }
    .separador { border-left-color: #ff7043; background-color: #ffe0b2; }
    .donoderua { border-left-color: #ffca28; background-color: #fff9c4; }
    .checkout { border-left-color: #66bb6a; background-color: #c8e6c9; }
    .empilhadores { 
      border-left-color: #29b6f6; 
      background-color: #b3e5fc; 
      page-break-inside: avoid; 
      overflow-wrap: break-word; 
    }
    .funcionarios-container {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      justify-content: space-between;
      border-top: 1px solid #ccc;
      padding-top: 5px;
    }
    .funcionario {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
      width: calc(33% - 5px);
      flex-wrap: wrap;
      gap: 3px;
      border: 1px solid #ddd;
      padding: 3px;
      border-radius: 4px;
    }
    .funcionario input {
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 12px;
      max-width: 160px;
      box-shadow: 1px 1px 2px rgba(0,0,0,0.05);
      background-color: #fff;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .funcionario input:focus {
      transform: scale(1.02);
      box-shadow: 2px 2px 4px rgba(0,0,0,0.1);
      border-color: #888;
    }
    .funcionario button {
      background: #eee;
      border: 1px solid #ccc;
      padding: 2px 5px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 10px;
    }
    #controles {
      margin-bottom: 10px;
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
      border: 1px solid #ccc;
      padding: 5px;
      border-radius: 5px;
      background: #fff;
    }
    #controles input, #controles select {
      padding: 6px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 11px;
    }
    #controles button {
      background: #0288d1;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
    }
    #logoPDF { display: none; }
    .turno-empilhador { font-size: 9px; margin-left: 3px; color: #555; }
    .input-separador { background-color: rgba(255, 224, 178, 0.4); }
    .input-donoderua { background-color: rgba(255, 249, 196, 0.4); }
    .input-checkout { background-color: rgba(200, 230, 201, 0.4); }
    .input-empilhadores { background-color: rgba(179, 229, 252, 0.4); }
    .input-horario-alt { border: 1px dotted #e57373; background-color: rgba(255, 200, 200, 0.2); }
    .input-data, .input-horario { border: 1px solid #999; background-color: #f9f9f9; }
  </style>
</head>
<body>

<img id="logoPDF" src="LOGO_DURÃES_VETORIZADA.png" alt="LOGO DURÃES" width="100">
<h1>TABELA DE HORÁRIOS</h1>
<div id="controles">
  <input type="text" id="nomeNovo" placeholder="NOME">
  <button type="button" id="btnEmoji">➕ Emojis</button>
  <div id="emojiContainer" style="display:none;"></div>

  <select id="setorNovo">
    <option value="separador1">SEPARADOR 1º TURNO</option>
    <option value="separador2">SEPARADOR 2º TURNO</option>
    <option value="donoderua1">DONO DE RUA 1º TURNO</option>
    <option value="donoderua2">DONO DE RUA 2º TURNO</option>
    <option value="checkout1">CHECKOUT 1º TURNO</option>
    <option value="checkout2">CHECKOUT 2º TURNO</option>
    <option value="empilhadores">EMPILHADORES</option>
  </select>

  <button onclick="adicionarFuncionario()">ADICIONAR</button>
  <button onclick="gerarPDF()">PDF</button>
  <button onclick="salvarDados()">SALVAR</button>
</div>

<div class="turno separador" id="separador1">
  <h2>SEPARADOR - 1º TURNO</h2>
  <div class="funcionarios-container"></div>
</div>

<div class="turno separador" id="separador2">
  <h2>SEPARADOR - 2º TURNO</h2>
  <div class="funcionarios-container"></div>
</div>

<div class="turno donoderua" id="donoderua1">
  <h2>DONO DE RUA - 1º TURNO</h2>
  <div class="funcionarios-container"></div>
</div>

<div class="turno donoderua" id="donoderua2">
  <h2>DONO DE RUA - 2º TURNO</h2>
  <div class="funcionarios-container"></div>
</div>

<div class="turno checkout" id="checkout1">
  <h2>CHECKOUT - 1º TURNO</h2>
  <div class="funcionarios-container"></div>
</div>

<div class="turno checkout" id="checkout2">
  <h2>CHECKOUT - 2º TURNO</h2>
  <div class="funcionarios-container"></div>
</div>

<div class="turno empilhadores" id="empilhadores">
  <h2>EMPILHADORES</h2>
  <div class="funcionarios-container"></div>
</div>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAvtcqhy-bj1iOpBVcIPBjvNfYygjHSpAY",
  authDomain: "horarios-duraes.firebaseapp.com",
  projectId: "horarios-duraes",
  storageBucket: "horarios-duraes.firebasestorage.app",
  messagingSenderId: "801770957942",
  appId: "1:801770957942:web:ce5d664d7f084281ac4357"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

function criarFuncionario(nome, setor, turno = 1, data = '', horario = '', horarioAlt = '') {
  const div = document.createElement('div');
  div.className = 'funcionario';

  const input = document.createElement('input');
  input.value = nome;
  input.setAttribute('maxlength', '50');

  let inputClass = '';
  if (setor.startsWith('separador')) inputClass = 'input-separador';
  else if (setor.startsWith('donoderua')) inputClass = 'input-donoderua';
  else if (setor.startsWith('checkout')) inputClass = 'input-checkout';
  else if (setor === 'empilhadores') inputClass = 'input-empilhadores';

  input.classList.add(inputClass);

  const turnoSpan = document.createElement('span');
  turnoSpan.className = 'turno-empilhador';
  turnoSpan.textContent = setor === 'empilhadores' ? `(${turno}º TURNO)` : '';

  const btnTroca = document.createElement('button');
  btnTroca.textContent = '⇄';
  btnTroca.onclick = () => moverFuncionario(div, setor, turnoSpan);

  const btnExcluir = document.createElement('button');
  btnExcluir.textContent = 'X';
  btnExcluir.onclick = () => { if (confirm('Tem certeza?')) { div.remove(); ordenarFuncionarios(setor); } };

  div.appendChild(input);
  div.appendChild(turnoSpan);

  if (setor === 'empilhadores') {
    const inputData = document.createElement('input');
    inputData.placeholder = 'DATA';
    inputData.className = 'input-data';
    inputData.value = data;

    const inputHorario = document.createElement('input');
    inputHorario.placeholder = 'HORÁRIO';
    inputHorario.className = 'input-horario';
    inputHorario.value = horario;

    div.appendChild(inputData);
    div.appendChild(inputHorario);
  }

  if (setor.startsWith('checkout')) {
    const inputHorarioAlt = document.createElement('input');
    inputHorarioAlt.placeholder = 'HORÁRIO ALT.';
    inputHorarioAlt.className = 'input-horario-alt';
    inputHorarioAlt.value = horarioAlt;
    div.appendChild(inputHorarioAlt);
  }

  div.appendChild(btnTroca);
  div.appendChild(btnExcluir);

  document.getElementById(setor).querySelector('.funcionarios-container').appendChild(div);
  ordenarFuncionarios(setor);
}

function adicionarFuncionario() {
  const nome = document.getElementById('nomeNovo').value.trim();
  const setor = document.getElementById('setorNovo').value;
  if (nome) {
    criarFuncionario(nome, setor);
    document.getElementById('nomeNovo').value = '';
  }
}

function moverFuncionario(div, setor, turnoSpan) {
  if (setor === 'empilhadores') {
    let turnoAtual = parseInt(turnoSpan.textContent[1]);
    turnoAtual = turnoAtual % 3 + 1;
    turnoSpan.textContent = `(${turnoAtual}º TURNO)`;
    ordenarFuncionarios(setor);
  } else {
    const parent = div.parentElement.parentElement.id;
    const proximo = parent === 'separador1' ? 'separador2' :
                    parent === 'separador2' ? 'separador1' :
                    parent === 'donoderua1' ? 'donoderua2' :
                    parent === 'donoderua2' ? 'donoderua1' :
                    parent === 'checkout1' ? 'checkout2' : 'checkout1';

    document.getElementById(proximo).querySelector('.funcionarios-container').appendChild(div);
    ordenarFuncionarios(proximo);
  }
}

function ordenarFuncionarios(setor) {
  const container = document.getElementById(setor).querySelector('.funcionarios-container');
  const funcionarios = Array.from(container.querySelectorAll('.funcionario'));
  funcionarios.sort((a, b) => a.querySelector('input').value.localeCompare(b.querySelector('input').value));
  funcionarios.forEach(f => container.appendChild(f));
}

function gerarPDF() {
  const clone = document.body.cloneNode(true);
  clone.querySelector('#controles').remove();

  clone.querySelectorAll('.funcionario button').forEach(btn => btn.remove());
  clone.querySelectorAll('.turno-empilhador').forEach(span => span.remove());

  clone.querySelectorAll('.input-horario-alt').forEach(input => {
    if (input.value.trim() === '') {
      input.remove();
    } else {
      const span = document.createElement('span');
      span.style = "display:inline-block; margin-left:5px; padding:2px 4px; border:1px solid #e57373; background:#ffe5e5; color:#e57373; font-weight:bold;";
      span.textContent = input.value.trim();
      input.parentNode.insertBefore(span, input.nextSibling);
      input.remove();
    }
  });

  const logo = document.getElementById('logoPDF').cloneNode();
  logo.style.display = 'block';
  clone.insertBefore(logo, clone.firstChild);

  html2pdf().set({
    margin: 5,
    filename: 'tabela_horarios.pdf',
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  }).from(clone).save();
}

function salvarDados() {
  const dados = {};
  document.querySelectorAll('.turno').forEach(turno => {
    const id = turno.id;
    dados[id] = { funcionarios: [] };
    turno.querySelectorAll('.funcionario').forEach(f => {
      const nome = f.querySelector('input').value;
      const turnoEmp = f.querySelector('.turno-empilhador')?.textContent;
      const data = f.querySelector('.input-data')?.value || '';
      const horario = f.querySelector('.input-horario')?.value || '';
      const horarioAlt = f.querySelector('.input-horario-alt')?.value || '';
      dados[id].funcionarios.push({ nome, turno: turnoEmp, data, horario, horarioAlt });
    });
  });
  db.collection("tabela").doc("horarios").set(dados).then(() => alert("DADOS SALVOS NO FIREBASE"));
}

window.onload = () => {
  db.collection("tabela").doc("horarios").get().then(doc => {
    if (doc.exists) {
      const dados = doc.data();
      for (let setor in dados) {
        dados[setor].funcionarios.forEach(f => {
          const turnoNum = f.turno ? parseInt(f.turno[1]) : 1;
          criarFuncionario(f.nome, setor, turnoNum, f.data, f.horario, f.horarioAlt);
        });
      }
    }
  });
}

document.addEventListener('DOMContentLoaded', () => {
  const btnEmoji = document.getElementById('btnEmoji');
  const emojiContainer = document.getElementById('emojiContainer');
  const nomeInput = document.getElementById('nomeNovo');

  btnEmoji.addEventListener('click', () => {
    emojiContainer.style.display = emojiContainer.style.display === 'none' ? 'flex' : 'none';
  });

  ['😀','😁','😂','🤣','😎','😍','🥰','😡','😢','😱','🤯','🙏','👊','👍','👎','✌️','🤟','👏','💪','🚀','⚡','🔥','🌟','🎯','🏆','🛠️','🎨','💼','🏅','🎁']
    .forEach(emoji => {
      const btn = document.createElement('button');
      btn.textContent = emoji;
      btn.onclick = () => { nomeInput.value += emoji; nomeInput.focus(); emojiContainer.style.display = 'none'; };
      emojiContainer.appendChild(btn);
    });
});
</script>
</body>
</html>
