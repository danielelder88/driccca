<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>DRICCA COSMÉTICOS</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="theme-color" content="#d63384" />
  <link rel="manifest" href="manifest.json" />
</head>
<body class="bg-gray-50 min-h-screen">
  <header class="bg-pink-600 text-white py-4 text-center text-2xl font-bold flex justify-center items-center gap-2 shadow-md">
    <i class="fa-solid fa-store"></i> DRICCA COSMÉTICOS
    <button onclick="logoutCliente()" class="ml-auto mr-4 text-white hover:text-gray-200 hidden" id="botaoLogout">
      <i class="fas fa-sign-out-alt"></i>
    </button>
  </header>

  <div class="p-4 max-w-3xl w-full mx-auto">
    <!-- Login, Cadastro e Área do Cliente já incluídos anteriormente -->

    <div class="bg-white p-6 rounded shadow mt-6 hidden" id="areaAdmin">
      <h2 class="text-xl font-bold text-pink-600 mb-4">Painel Administrativo</h2>
      <div id="painelVendas" class="mb-4 text-green-700 font-semibold"></div>

      <h3 class="text-lg font-semibold text-pink-600 mb-2">Pedidos</h3>
      <div id="pedidosContainer" class="space-y-2"></div>

      <h3 class="text-lg font-semibold text-pink-600 mt-6 mb-2">Cadastrar Produto</h3>
      <input class="p-2 border rounded w-full mb-2 focus:outline-none focus:ring-2 focus:ring-pink-400" id="produtoNome" placeholder="Nome do produto" type="text" required />
      <input class="p-2 border rounded w-full mb-2 focus:outline-none focus:ring-2 focus:ring-pink-400" id="produtoDescricao" placeholder="Descrição" type="text" required />
      <input class="p-2 border rounded w-full mb-2 focus:outline-none focus:ring-2 focus:ring-pink-400" id="produtoPreco" placeholder="Preço" type="number" required />
      <input class="p-2 border rounded w-full mb-2 focus:outline-none focus:ring-2 focus:ring-pink-400" id="produtoQtd" placeholder="Quantidade" type="number" required />
      <input class="p-2 border rounded w-full mb-2 hidden" id="produtoImagem" type="hidden" />
      <input accept="image/*" capture="environment" class="mb-2" id="inputImagem" onchange="uploadImagem(this)" type="file" />

      <button class="bg-pink-600 hover:bg-pink-700 text-white font-semibold py-2 px-4 rounded mt-2 w-full" onclick="cadastrarProduto()">Cadastrar Produto</button>

      <h3 class="text-lg font-semibold text-pink-600 mt-6 mb-2">Gráfico de Vendas</h3>
      <canvas id="graficoVendas" height="200"></canvas>

      <h3 class="text-lg font-semibold text-pink-600 mt-6 mb-2">Mensagens de Suporte</h3>
      <div id="mensagensSuporte" class="space-y-2"></div>

      <h3 class="text-lg font-semibold text-pink-600 mt-6 mb-2">Relatório</h3>
      <button class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded mt-2 w-full" onclick="exportarRelatorioPedidos()">Exportar Relatório (PDF)</button>
    </div>
  </div>

  <script>
    function cadastrarProduto() {
      const nome = document.getElementById("produtoNome").value.trim();
      const descricao = document.getElementById("produtoDescricao").value.trim();
      const preco = parseFloat(document.getElementById("produtoPreco").value);
      const quantidade = parseInt(document.getElementById("produtoQtd").value);
      const imagem = document.getElementById("produtoImagem").value;

      if (!nome || !descricao || isNaN(preco) || isNaN(quantidade) || !imagem) {
        mostrarToast("Preencha todos os campos para cadastrar um produto.");
        return;
      }

      db.collection("produtos").where("nome", "==", nome).get().then(snapshot => {
        if (!snapshot.empty) {
          mostrarToast("Produto já cadastrado com esse nome.");
          return;
        }
        const novoProduto = { nome, descricao, preco, quantidade, imagem };
        db.collection("produtos").add(novoProduto).then(() => {
          mostrarToast("Produto cadastrado com sucesso!");
          document.getElementById("produtoNome").value = "";
          document.getElementById("produtoDescricao").value = "";
          document.getElementById("produtoPreco").value = "";
          document.getElementById("produtoQtd").value = "";
          document.getElementById("produtoImagem").value = "";
        });
      });
    }

    function carregarPedidos() {
      db.collection("pedidos").get().then(snapshot => {
        let total = 0;
        let container = document.getElementById("pedidosContainer");
        let vendasPorMes = {};
        container.innerHTML = "";
        snapshot.forEach(doc => {
          const p = doc.data();
          total += parseFloat(p.total);
          const data = new Date(p.data);
          const mes = data.toLocaleString('default', { month: 'short' }) + '/' + data.getFullYear();
          vendasPorMes[mes] = (vendasPorMes[mes] || 0) + parseFloat(p.total);
          container.innerHTML += `<div class='border p-2 rounded shadow-sm bg-gray-50'>${p.nome} - R$ ${p.total}<br><small>${p.data}</small></div>`;
        });
        document.getElementById("painelVendas").innerHTML = `Total de Vendas: R$ ${total.toFixed(2)}`;
        const labels = Object.keys(vendasPorMes);
        const dados = Object.values(vendasPorMes);
        new Chart(document.getElementById("graficoVendas"), {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{ label: 'Vendas por mês', data: dados, backgroundColor: '#d63384' }]
          }
        });
      });

      db.collection("suporte").orderBy("data", "desc").get().then(snapshot => {
        const suporteContainer = document.getElementById("mensagensSuporte");
        suporteContainer.innerHTML = "";
        snapshot.forEach(doc => {
          const s = doc.data();
          suporteContainer.innerHTML += `<div class='border p-2 rounded shadow-sm bg-white'><strong>${s.nome}</strong>: ${s.mensagem}<br><small>${s.data}</small></div>`;
        });
      });
    }
  </script>
</body>
</html>
