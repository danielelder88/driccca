<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>DRICCA COSMÉTICOS</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #fdfdfd; }
    header { background: #d63384; color: white; padding: 15px; text-align: center; font-size: 1.5em; font-weight: bold; }
    .container { padding: 20px; max-width: 900px; margin: auto; }
    .hidden { display: none !important; }
    input, button {
      padding: 10px; margin: 5px 0; width: 100%; box-sizing: border-box; border-radius: 5px; border: 1px solid #ccc;
    }
    button { background-color: #d63384; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #c2185b; }
    .title { font-size: 1.2em; margin: 20px 0 10px; color: #d63384; }
    .produto, .carrinho-item {
      background: white; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <header><i class="fa-solid fa-store"></i> DRICCA COSMÉTICOS</header>
  <div class="container">
    <div id="loginCliente">
      <h2 class="title">Login do Cliente</h2>
      <input type="email" id="clienteEmail" placeholder="Email">
      <input type="password" id="clienteSenha" placeholder="Senha">
      <button onclick="loginCliente()">Entrar</button>
      <button onclick="mostrarCadastroCliente()">Cadastrar</button>
    </div>
    <div id="cadastroCliente" class="hidden">
      <h2 class="title">Cadastro de Cliente</h2>
      <input type="text" id="nomeCliente" placeholder="Nome">
      <input type="email" id="emailCliente" placeholder="Email">
      <input type="password" id="senhaCliente" placeholder="Senha">
      <button onclick="cadastrarCliente()">Cadastrar</button>
      <button onclick="mostrarLoginCliente()">Voltar</button>
    </div>
    <div id="areaCliente" class="hidden">
      <h2 class="title">Bem-vindo, <span id="nomeExibicao"></span></h2>
      <div id="produtosContainer"></div>
      <h3 class="title">Carrinho</h3>
      <div id="carrinhoContainer"></div>
      <input type="text" id="cupomInput" placeholder="Cupom de desconto">
      <button onclick="finalizarPedido()">Finalizar Pedido (WhatsApp)</button>
      <button onclick="logoutCliente()" style="margin-top:10px;">Sair</button>
    </div>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAu0i-nJRJFhUmcB2NCYcueR0i7xGA4Rws",
    authDomain: "dricca-ecommerce.firebaseapp.com",
    projectId: "dricca-ecommerce",
    storageBucket: "dricca-ecommerce.appspot.com",
    messagingSenderId: "202913391561",
    appId: "1:202913391561:web:50cddc607a67540be4be18"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  let usuarioAtual = null;
  let carrinho = [];

  function mostrarCadastroCliente() {
    document.getElementById('loginCliente').classList.add('hidden');
    document.getElementById('cadastroCliente').classList.remove('hidden');
  }

  function mostrarLoginCliente() {
    document.getElementById('cadastroCliente').classList.add('hidden');
    document.getElementById('areaCliente').classList.add('hidden');
    document.getElementById('loginCliente').classList.remove('hidden');
  }

  function mostrarAreaCliente(nome) {
    document.getElementById('loginCliente').classList.add('hidden');
    document.getElementById('cadastroCliente').classList.add('hidden');
    document.getElementById('areaCliente').classList.remove('hidden');
    document.getElementById('nomeExibicao').innerText = nome;
    listarProdutos();
  }

  function cadastrarCliente() {
    const nome = document.getElementById('nomeCliente').value;
    const email = document.getElementById('emailCliente').value;
    const senha = document.getElementById('senhaCliente').value;
    auth.createUserWithEmailAndPassword(email, senha)
      .then(cred => db.collection("clientes").doc(cred.user.uid).set({ nome, email }))
      .then(() => {
        alert("Cadastro realizado!");
        mostrarLoginCliente();
      })
      .catch(e => alert("Erro: " + e.message));
  }

  function loginCliente() {
    const email = document.getElementById('clienteEmail').value;
    const senha = document.getElementById('clienteSenha').value;
    auth.signInWithEmailAndPassword(email, senha)
      .then(cred => db.collection("clientes").doc(cred.user.uid).get())
      .then(doc => {
        if (doc.exists) {
          usuarioAtual = doc.data();
          mostrarAreaCliente(usuarioAtual.nome);
        }
      })
      .catch(e => alert("Erro: " + e.message));
  }

  function logoutCliente() {
    if (confirm("Deseja sair da sua conta?")) {
      auth.signOut().then(() => {
        usuarioAtual = null;
        carrinho = [];
        mostrarLoginCliente();
      });
    }
  }

  function listarProdutos() {
    const container = document.getElementById("produtosContainer");
    container.innerHTML = "";
    db.collection("produtos").get().then(snapshot => {
      snapshot.forEach(doc => {
        const p = doc.data();
        const id = doc.id;
        container.innerHTML += `
          <div class="produto">
            <img src="${p.imagem}">
            <div>
              <strong>${p.nome}</strong><br>${p.descricao}<br>
              <strong>R$ ${p.preco.toFixed(2)}</strong><br>Estoque: ${p.quantidade}<br><br>
              <button onclick="adicionarAoCarrinho('${id}', ${p.preco}, '${p.nome}')">Adicionar</button>
            </div>
          </div>`;
      });
    });
  }

  function adicionarAoCarrinho(id, preco, nome) {
    const existente = carrinho.find(i => i.id === id);
    if (existente) existente.qtd++;
    else carrinho.push({ id, nome, preco, qtd: 1 });
    renderizarCarrinho();
  }

  function renderizarCarrinho() {
    const container = document.getElementById("carrinhoContainer");
    container.innerHTML = "";
    carrinho.forEach(item => {
      container.innerHTML += `<div class='carrinho-item'>${item.nome} (Qtd: ${item.qtd})
        <button onclick="removerDoCarrinho('${item.id}')">Remover</button></div>`;
    });
  }

  function removerDoCarrinho(id) {
    carrinho = carrinho.filter(i => i.id !== id);
    renderizarCarrinho();
  }

  function finalizarPedido() {
    const cupom = document.getElementById("cupomInput").value.trim();
    let total = carrinho.reduce((s, i) => s + i.preco * i.qtd, 0);
    let msg = `Olá, sou ${usuarioAtual.nome}. Gostaria de fazer um pedido:%0A`;
    carrinho.forEach(i => msg += `- ${i.nome} (Qtd: ${i.qtd})%0A`);
    if (cupom === "DESCONTO10") {
      total *= 0.9;
      msg += `Cupom aplicado: DESCONTO10 (10%% OFF)%0A`;
    }
    msg += `Total: R$ ${total.toFixed(2)}`;
    db.collection("pedidos").add({ nome: usuarioAtual.nome, total: total.toFixed(2), data: new Date().toISOString(), itens: carrinho });
    window.open(`https://wa.me/5593988098093?text=${msg}`, '_blank');
    carrinho = [];
    renderizarCarrinho();
  }

  auth.onAuthStateChanged(user => {
    if (user) {
      db.collection("clientes").doc(user.uid).get().then(doc => {
        if (doc.exists) {
          usuarioAtual = doc.data();
          mostrarAreaCliente(usuarioAtual.nome);
        }
      });
    }
  });
</script>
  </div> <!-- fecha .container -->
</body>
</html>
